<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title ng-bind="title + ' &mdash; Hex'">Hex</title>

    <meta name="description" content="The Tint Library of BigBoards" />
    <meta name="keywords" content="BigBoards, Tint, Library" />
    <meta name="author" content="BigBoards" />

    <link rel="shortcut icon" href="favicon.ico">

    <link rel="stylesheet" href="bower_components/angular-material/angular-material.css">
    <link rel="stylesheet" href="style/main.css">
    <link rel="stylesheet" href="style/linear-font.css">
    <!--<link rel="stylesheet" href="style/style.css">-->
    <link rel="stylesheet" href="style/util.css">

    <link rel="stylesheet" href="app/library/style.css">
    <link rel="stylesheet" href="app/designer/style.css">

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='bower_components/fontawesome/css/font-awesome.css' rel='stylesheet' type='text/css'>

    <!--[if lt IE 9]>
    <script type="text/javascript" src="bower_components/html5shiv/dist/html5shiv.js"></script>
    <![endif]-->
</head>

<body ng-controller="ApplicationController" layout="column">
    <div layout="row" flex>
        <md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia('gt-md')">
            <md-toolbar class="md-theme-indigo">
                <h1 class="md-toolbar-tools" layout-align="center center"><span style="font-weight: 700; font-size: 28px;">BIG</span><span style="font-weight: 300; font-size: 28px;">BOARDS</span></h1>
            </md-toolbar>
            <md-content ng-include="menuPartial"> </md-content>
        </md-sidenav>
        <div layout="column" flex id="content">
            <md-content layout="column" flex ng-view style="background-color: #f5f5f5;" class="bb-background">

            </md-content>
        </div>
    </div>


    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/angular-aria/angular-aria.js"></script>
    <script src="bower_components/angular-animate/angular-animate.js"></script>
    <script src="bower_components/angular-material/angular-material.js"></script>
    <script src="bower_components/angular-resource/angular-resource.js"></script>
    <script src="bower_components/angular-route/angular-route.js"></script>
    <script src="bower_components/angular-socket-io/socket.js"></script>
    <script src="bower_components/angular-webstorage/angular-webstorage.min.js"></script>
    <script src="bower_components/angular-gravatar/build/angular-gravatar.js"></script>
    <script src="bower_components/socket.io-client/dist/socket.io.js"></script>

    <script src="app/core.js"></script>
    <script src="app/library/module.js"></script>
    <script src="app/hive.js"></script>

    <script src="app/common/services.js"></script>
    <script src="app/common/directives.js"></script>

    <script src="app/dashboard/module.js"></script>
    <script src="app/designer/module.js"></script>
    <script src="app/login/module.js"></script>

    <script src="app/people/module.js"></script>
    <script src="app/settings/module.js"></script>

    <script src="app/test/module.js"></script>


<script>
    function getUrlVars() {
        var vars = [], hash;
        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
        for(var i = 0; i < hashes.length; i++)
        {
            hash = hashes[i].split('=');
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
        }
        return vars;

    }

    angular.element(document).ready(function() {
        var tokenParameter = getUrlVars()['token'];
        if (tokenParameter) sessionStorage.token = JSON.stringify(tokenParameter);

        var settings = {
//            api: 'http://hive-api-test-env.elasticbeanstalk.com'
            api: 'http://localhost:8081'
        };
        sessionStorage.settings = JSON.stringify(settings);

        if (sessionStorage.token) {
            $.getJSON(settings.api + '/api/v1/auth/' + JSON.parse(sessionStorage.token))
                .done(function( data ) {
                    sessionStorage.user = JSON.stringify(data.data);
                    angular.bootstrap(document, ['hive']);
                })
                .fail(function() {
                    // -- remove the token from the web storage
                    delete sessionStorage.token;
                    delete sessionStorage.user;

                    // -- redirect to the login page
                    window.location.href = '/#/login?reason=InvalidToken';
                    angular.bootstrap(document, ['hive']);
                })
        } else {
            if (window.location.href.indexOf('/#/login') == -1) window.location.href = '/#/login';
            angular.bootstrap(document, ['hive']);
        }
    });
</script>

</body>
</html>